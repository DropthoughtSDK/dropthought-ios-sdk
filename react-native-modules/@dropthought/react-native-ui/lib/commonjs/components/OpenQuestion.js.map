{"version":3,"sources":["OpenQuestion.tsx"],"names":["MAX_CHARACTER","metadataTypeKeyboard","metadataType","QuestionMetaDataType","Email","Phone","Number","Platform","select","ios","default","Date","metadataTypeAutoCapitalize","Name","MetadataDesc","question","rtl","dimensionWidthType","styles","DimensionWidthType","phone","phoneStyles","metaDataType","desc","i18n","t","descText","GlobalStyle","textAlignRight","OpenQuestion","anonymous","onFeedback","feedback","forgot","themeColor","colorScheme","fontColor","text","setText","React","useState","answers","focus","setFocus","hasEdited","setHasEdited","onEndEditingHandler","questionId","type","getBackgroundColorStyle","borderColor","dir","showAnonymousWarning","maxCharacterLength","characterLeft","length","isValid","tempFeedback","hasForgot","upperView","title","inputView","inputBG","COLOR_SCHEMES","dark","inputBGDark","input","color","questionBrand","Colors","inputPlaceholder","bottomView","subTextRow","flexRowReverse","questionContainer","StyleSheet","create","openQuestionSubTitle","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","borderWidth","borderRadius","height","marginVertical","paddingHorizontal","borderColorDark","flex","textAlignVertical","paddingVertical15","paddingVertical","android","metaDataTypeInput","flexDirection","justifyContent","width","marginBottom"],"mappings":"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","sourcesContent":["import React from 'react';\nimport {\n  View,\n  StyleSheet,\n  Text,\n  TextInput,\n  Platform,\n  KeyboardTypeOptions,\n} from 'react-native';\nimport {\n  QuestionMetaDataType,\n  metaDataTypeQuestionValidator,\n  mandatoryQuestionValidator,\n} from '../utils/data';\nimport GlobalStyle, { Colors } from '../styles';\nimport MandatoryTitle from './MandatoryTitle';\nimport i18n from '../translation';\nimport {\n  DimensionWidthType,\n  useDimensionWidthType,\n} from '../hooks/useWindowDimensions';\nimport { useTheme, COLOR_SCHEMES } from '../contexts/theme';\nimport type {\n  QuestionMetaDataType as TypeQuestionMetaDataType,\n  Question,\n  Feedback,\n} from '../data';\n\nconst MAX_CHARACTER = 4000;\n\nconst metadataTypeKeyboard = (\n  metadataType: TypeQuestionMetaDataType | undefined\n): KeyboardTypeOptions | undefined => {\n  switch (metadataType) {\n    case QuestionMetaDataType.Email:\n      return 'email-address';\n    case QuestionMetaDataType.Phone:\n      return 'phone-pad';\n    case QuestionMetaDataType.Number:\n      return Platform.select({\n        ios: 'numbers-and-punctuation',\n        default: 'default',\n      });\n    case QuestionMetaDataType.Date:\n    default:\n      return 'default';\n  }\n};\n\nconst metadataTypeAutoCapitalize = (\n  metadataType: TypeQuestionMetaDataType | undefined\n) => {\n  switch (metadataType) {\n    case QuestionMetaDataType.Name:\n      return 'words';\n    case QuestionMetaDataType.Email:\n    case QuestionMetaDataType.Phone:\n    case QuestionMetaDataType.Date:\n    case QuestionMetaDataType.Number:\n      return 'none';\n    default:\n      return 'sentences';\n  }\n};\n\nconst MetadataDesc = ({\n  question,\n  rtl,\n}: {\n  question: Question;\n  rtl: boolean;\n}) => {\n  const dimensionWidthType = useDimensionWidthType();\n  const styles =\n    dimensionWidthType === DimensionWidthType.phone ? phoneStyles : phoneStyles;\n\n  if (!question.metaDataType) return null;\n\n  // if translation is not found, do not print anything\n  const desc = i18n.t(`metadata-question-desc:${question.metaDataType}`, '');\n  if (!desc) return null;\n\n  return (\n    <Text style={[styles.descText, rtl && GlobalStyle.textAlignRight]}>\n      {desc}\n    </Text>\n  );\n};\n\ntype Props = {\n  anonymous: boolean;\n  question: Question;\n  onFeedback: (feedback: Feedback) => void;\n  feedback: Feedback;\n  forgot: boolean;\n  themeColor: string;\n};\n\nconst OpenQuestion = ({\n  anonymous,\n  question,\n  onFeedback,\n  // onValueChange, // Keep it for Kiosk usage\n  feedback,\n  forgot,\n  themeColor,\n}: Props) => {\n  const { colorScheme, fontColor } = useTheme();\n  const [text, setText] = React.useState<string>(\n    feedback?.answers[0] ? `${feedback?.answers[0]}` : ''\n  );\n  const [focus, setFocus] = React.useState(false);\n  const [hasEdited, setHasEdited] = React.useState(false);\n\n  const dimensionWidthType = useDimensionWidthType();\n  const styles =\n    dimensionWidthType === DimensionWidthType.phone ? phoneStyles : phoneStyles;\n\n  const onEndEditingHandler = () => {\n    setHasEdited(true);\n    onFeedback({\n      questionId: question.questionId,\n      answers: [text],\n      type: 'open',\n    });\n  };\n\n  const getBackgroundColorStyle = () => {\n    return { borderColor: themeColor };\n  };\n\n  const rtl = i18n.dir() === 'rtl';\n  const showAnonymousWarning =\n    anonymous &&\n    question.metaDataType &&\n    (question.metaDataType === 'Email' ||\n      question.metaDataType === 'Name' ||\n      question.metaDataType === 'Phone');\n\n  const maxCharacterLength = MAX_CHARACTER;\n  const characterLeft = maxCharacterLength - text.length;\n\n  const isValid = metaDataTypeQuestionValidator(question, text);\n\n  /** @type {Feedback} */\n  const tempFeedback = {\n    questionId: question.questionId,\n    answers: [text],\n    type: 'open',\n  };\n  const hasForgot =\n    forgot && !mandatoryQuestionValidator(question, tempFeedback);\n\n  const upperView = (\n    <>\n      <MandatoryTitle\n        forgot={hasForgot}\n        invalidMessage={\n          // show the error message after the user has done edited\n          hasEdited && !isValid\n            ? i18n.t(`metadata-invalid-message:${question.metaDataType}`, '')\n            : ''\n        }\n        question={question}\n        style={styles.title}\n      />\n      <MetadataDesc question={question} rtl={rtl} />\n    </>\n  );\n\n  const inputView = (\n    <View\n      style={[\n        styles.inputBG,\n        colorScheme === COLOR_SCHEMES.dark ? styles.inputBGDark : {},\n        focus && getBackgroundColorStyle(),\n        // question.metaDataType && styles.metaDataTypeInput,\n        // !question.metaDataType && styles.paddingVertical15,\n      ]}\n    >\n      <TextInput\n        style={[\n          styles.input,\n          { color: fontColor },\n          rtl && GlobalStyle.textAlignRight,\n        ]}\n        multiline={true}\n        onChangeText={(t) => {\n          setText(t);\n          // onValueChange(text) // Keep it for Kiosk usage\n        }}\n        placeholder={question.questionBrand}\n        placeholderTextColor={Colors.inputPlaceholder}\n        onEndEditing={onEndEditingHandler}\n        value={text}\n        onFocus={() => {\n          setFocus(true);\n        }}\n        onBlur={() => {\n          setFocus(false);\n        }}\n        maxLength={maxCharacterLength}\n        keyboardType={metadataTypeKeyboard(question.metaDataType)}\n        autoCapitalize={metadataTypeAutoCapitalize(question.metaDataType)}\n      />\n    </View>\n  );\n\n  const bottomView = (\n    <View style={[styles.subTextRow, rtl && GlobalStyle.flexRowReverse]}>\n      <Text style={styles.descText}>\n        {showAnonymousWarning && i18n.t('survey:metadata-anonymous-warning')}\n      </Text>\n      <Text style={styles.descText}>\n        {characterLeft} / {maxCharacterLength}\n      </Text>\n    </View>\n  );\n\n  return (\n    <View style={GlobalStyle.questionContainer}>\n      {upperView}\n      {inputView}\n      {bottomView}\n    </View>\n  );\n};\n\nexport default OpenQuestion;\n\nconst phoneStyles = StyleSheet.create({\n  descText: {\n    color: Colors.openQuestionSubTitle,\n    fontSize: 12,\n    fontStyle: 'normal',\n    fontWeight: 'normal',\n    letterSpacing: 0,\n    lineHeight: 17,\n  },\n  inputBG: {\n    borderColor: Colors.borderColor,\n    borderWidth: 1,\n    borderRadius: 4,\n    height: 101,\n    marginVertical: 10,\n    paddingHorizontal: 15,\n  },\n  inputBGDark: {\n    borderColor: Colors.borderColorDark,\n  },\n  input: {\n    flex: 1,\n\n    // when multi=true, it is important to note that this aligns the text to the top on iOS,\n    // and centers it on Android. Use with textAlignVertical set to top for the same behavior in both platforms.\n    textAlignVertical: 'top', // this is an android only props, won't affect ios\n  },\n  paddingVertical15: {\n    ...Platform.select({\n      ios: {\n        paddingVertical: 15,\n      },\n      android: {\n        paddingVertical: 5,\n      },\n    }),\n  },\n  metaDataTypeInput: {\n    fontSize: 14,\n    height: 40,\n  },\n  subTextRow: {\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    width: '100%',\n  },\n  title: {\n    marginBottom: 6,\n  },\n});\n"]}