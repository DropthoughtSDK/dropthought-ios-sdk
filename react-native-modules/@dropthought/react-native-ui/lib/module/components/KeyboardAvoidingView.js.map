{"version":3,"sources":["KeyboardAvoidingView.tsx"],"names":["React","View","TextInput","StyleSheet","Platform","Keyboard","UIManager","LayoutAnimation","findNodeHandle","ScrollView","OS","setLayoutAnimationEnabledExperimental","computeOffset","keyboardEvent","frameBottomY","show","offset","keyboardEndY","endCoordinates","screenY","select","android","default","Math","min","configureLayoutAnimation","duration","easing","configureNext","max","update","type","Types","easeIn","useKeyboardAvoidingFocusedInputView","parentViewRef","extraAvoidingSpace","bottomHeight","setBottomHeight","useState","keyboardChangeHandler","useCallback","event","currentlyFocusedField","State","currentlyFocusedInput","current","viewIsDescendantOf","isDescendant","measureInWindow","_x","y","_width","height","currentlyFocusedFieldBottomY","useEffect","keyboardEvents","name","subscriptions","map","eventInfo","addListener","cleanup","forEach","subscription","remove","KeyboardAvoidingView","children","style","props","viewRef","useRef","compose","styles","contentContainerStyle","bottom","KeyboardAvoidingScrollViewForwardRef","ref","KeyboardAvoidingScrollView","forwardRef","create"],"mappings":"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","sourcesContent":["import React from 'react';\nimport {\n  View,\n  TextInput,\n  StyleSheet,\n  Platform,\n  Keyboard,\n  UIManager,\n  LayoutAnimation,\n  findNodeHandle,\n  ScrollView,\n  KeyboardEvent,\n  KeyboardEventName,\n  ViewProps,\n  ScrollViewProps,\n  ViewStyle,\n} from 'react-native';\n\nif (Platform.OS === 'android') {\n  if (UIManager.setLayoutAnimationEnabledExperimental) {\n    UIManager.setLayoutAnimationEnabledExperimental(true);\n  }\n}\n\n// compute the offsets from keyboard End coordinate to frame's bottom\nconst computeOffset = (\n  keyboardEvent: KeyboardEvent,\n  frameBottomY: number | undefined | null,\n  show: boolean\n) => {\n  let offset = 0;\n  if (keyboardEvent && show && frameBottomY) {\n    // the offset from keyboard coordinate to view's bottom Y coordinate\n    const keyboardEndY =\n      keyboardEvent.endCoordinates.screenY -\n      Platform.select({\n        // it looks that in android, it didn't consider the the suggestion box of the keyboard\n        android: 40,\n        default: 0,\n      });\n\n    // only consider the negative\n    offset = Math.min(keyboardEndY - frameBottomY, 0);\n  }\n  return offset;\n};\n\nconst configureLayoutAnimation = (keyboardEvent: KeyboardEvent) => {\n  const { duration = 0, easing } = keyboardEvent;\n  if (easing) {\n    LayoutAnimation.configureNext({\n      // We have to pass the duration equal to minimal accepted duration defined here: RCTLayoutAnimation.m\n      duration: Math.max(duration, 10),\n      update: {\n        duration: Math.max(duration, 10),\n        type:\n          Platform.OS === 'android'\n            ? LayoutAnimation.Types.easeIn\n            : LayoutAnimation.Types[easing],\n      },\n    });\n  }\n};\n\nexport const useKeyboardAvoidingFocusedInputView = (\n  parentViewRef: { current?: View },\n  extraAvoidingSpace = 0\n): { bottomHeight: number } => {\n  const [bottomHeight, setBottomHeight] = React.useState<number>(0);\n\n  const keyboardChangeHandler = React.useCallback(\n    (event, show) => {\n      // @ts-ignore\n      const currentlyFocusedField = TextInput.State.currentlyFocusedInput\n        ? // @ts-ignore\n          findNodeHandle(TextInput.State.currentlyFocusedInput())\n        : TextInput.State.currentlyFocusedField();\n\n      // if there's no focused input or keyboard is not show or view is not existed\n      if (!currentlyFocusedField || !show || !parentViewRef.current) {\n        configureLayoutAnimation(event);\n        setBottomHeight(0);\n        return;\n      }\n\n      // here we want to check if the focused input is \"within\" this view\n      // if it is not this view, do nothing (it could be a un-focused screen)\n      // @ts-ignore\n      UIManager.viewIsDescendantOf(\n        currentlyFocusedField,\n        findNodeHandle(parentViewRef.current),\n        (isDescendant: boolean) => {\n          if (isDescendant) {\n            // measure the input's layout, compute the offset to the keyboard\n            UIManager.measureInWindow(\n              currentlyFocusedField,\n              (_x, y, _width, height) => {\n                const currentlyFocusedFieldBottomY =\n                  y + height + extraAvoidingSpace;\n                const offset = computeOffset(\n                  event,\n                  currentlyFocusedFieldBottomY,\n                  show\n                );\n                // if the offset is smaller than 0, it means it is below the keyboard\n                if (offset < 0) {\n                  configureLayoutAnimation(event);\n                  setBottomHeight(0 - offset);\n                }\n              }\n            );\n          }\n        }\n      );\n    },\n    [parentViewRef, extraAvoidingSpace]\n  );\n\n  // keyboard change effect\n  React.useEffect(() => {\n    // subscribe to these keyboard events\n    let keyboardEvents: { name: KeyboardEventName; show: boolean }[] =\n      Platform.select({\n        default: [\n          { name: 'keyboardWillShow', show: true },\n          { name: 'keyboardWillHide', show: false },\n        ],\n        android: [\n          { name: 'keyboardDidShow', show: true },\n          { name: 'keyboardDidHide', show: false },\n        ],\n      });\n\n    let subscriptions = keyboardEvents.map((eventInfo) => {\n      return Keyboard.addListener(eventInfo.name, (event) =>\n        keyboardChangeHandler(event, eventInfo.show)\n      );\n    });\n\n    return function cleanup() {\n      subscriptions.forEach((subscription) => {\n        subscription.remove();\n      });\n    };\n  }, [keyboardChangeHandler]);\n\n  return {\n    bottomHeight,\n  };\n};\n\ninterface KeyboardAvoidingViewProps extends ViewProps {\n  extraAvoidingSpace: number;\n}\n\nconst KeyboardAvoidingView: React.FC<KeyboardAvoidingViewProps> = ({\n  children,\n  style,\n  extraAvoidingSpace = 0,\n  ...props\n}) => {\n  const viewRef = React.useRef<View>(null);\n  const { bottomHeight } = useKeyboardAvoidingFocusedInputView(\n    // @ts-ignore\n    viewRef,\n    extraAvoidingSpace\n  );\n\n  if (Platform.OS === 'android') {\n    return (\n      <View style={style} {...props}>\n        {children}\n      </View>\n    );\n  }\n\n  return (\n    <View ref={viewRef} style={style} {...props}>\n      <View\n        style={StyleSheet.compose(styles.contentContainerStyle, {\n          // @ts-ignore\n          bottom: bottomHeight,\n        })}\n      >\n        {children}\n      </View>\n    </View>\n  );\n};\n\n/**\n * @param {KeyboardAvoidingProps & ScrollViewProps} param0\n * @param {*} ref\n */\n\ninterface KeyboardAvoidingScrollViewProps extends ScrollViewProps {\n  contentContainerStyle: ViewStyle;\n  style: any;\n  extraAvoidingSpace: number;\n}\n\nconst KeyboardAvoidingScrollViewForwardRef: React.FC<KeyboardAvoidingScrollViewProps> =\n  (\n    {\n      children,\n      style,\n      contentContainerStyle,\n      extraAvoidingSpace = 0,\n      ...props\n    },\n    ref\n  ) => {\n    const { bottomHeight } = useKeyboardAvoidingFocusedInputView(\n      ref,\n      extraAvoidingSpace\n    );\n\n    if (Platform.OS === 'android') {\n      return (\n        <ScrollView\n          style={style}\n          contentContainerStyle={contentContainerStyle}\n          {...props}\n          ref={ref}\n        >\n          {children}\n        </ScrollView>\n      );\n    }\n\n    return (\n      <ScrollView\n        ref={ref}\n        style={style}\n        contentContainerStyle={StyleSheet.compose(contentContainerStyle, {\n          bottom: bottomHeight,\n        })}\n        {...props}\n      >\n        {children}\n      </ScrollView>\n    );\n  };\n\n/** @type {React.FunctionComponent<KeyboardAvoidingProps & ScrollViewProps>} */\nexport const KeyboardAvoidingScrollView = React.forwardRef(\n  // @ts-ignore\n  KeyboardAvoidingScrollViewForwardRef\n);\n\nconst styles = StyleSheet.create({\n  contentContainerStyle: {\n    height: '100%',\n  },\n});\n\nexport default KeyboardAvoidingView;\n\n/**\n * @typedef {object} KeyboardAvoidingProps\n * @property {ViewStyle} contentContainerStyle\n * @property {ViewStyle} style\n * @property {number=} extraAvoidingSpace - optional, the default behavior of this keyboard avoiding is to avoid the whole input box, but if you wish to have extra space to avoid\n */\n"]}