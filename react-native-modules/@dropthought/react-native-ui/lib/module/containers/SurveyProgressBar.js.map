{"version":3,"sources":["SurveyProgressBar.tsx"],"names":["React","StyleSheet","View","Platform","sum","useSafeAreaInsets","useKeyboard","ProgressBar","useFeedbackState","opacity10","numValidFeedbacks","answeredQuestionIds","feedbacksMap","filter","qid","feedback","answers","length","answer","numTotalQuestions","survey","questionNumOfPages","pages","map","page","questions","isAndroid","OS","SurveyProgressBar","rtl","props","feedbackState","themeColor","surveyProperty","hexCode","insets","keyboardShown","insetsBottom","bottom","containerStyle","useMemo","styles","container","backgroundColor","paddingBottom","create","paddingHorizontal","width","memo"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { StyleSheet, View, Platform } from 'react-native';\nimport { sum } from 'ramda';\n// @ts-ignore\nimport { useSafeAreaInsets } from 'react-native-safe-area-context';\nimport { useKeyboard } from '@react-native-community/hooks';\n\nimport ProgressBar from '../components/ProgressBar';\nimport { useFeedbackState } from '../contexts/feedback';\nimport { opacity10 } from '../styles';\nimport type { Survey, Feedback } from '../data';\n\nconst numValidFeedbacks = ({\n  answeredQuestionIds,\n  feedbacksMap,\n}: {\n  answeredQuestionIds: string[];\n  feedbacksMap: { [key: string]: Feedback };\n}) => {\n  return answeredQuestionIds.filter((qid) => {\n    const feedback = feedbacksMap[qid];\n\n    // if no answers or 0 length, filter out\n    if (!feedback || !feedback.answers || !feedback.answers.length) {\n      return false;\n    }\n\n    // a special case: answers: [\"\"], should also consider as invalid\n    const answer = feedback.answers[0];\n    if (typeof answer === 'string' && !answer.length) {\n      return false;\n    }\n\n    return true;\n  }).length;\n};\n\nconst numTotalQuestions = (survey: Survey) => {\n  const questionNumOfPages = survey.pages.map((page) => page.questions.length);\n  return sum(questionNumOfPages);\n};\n\nconst isAndroid = Platform.OS === 'android';\n\ntype Props = {\n  rtl: boolean;\n  survey: Survey;\n};\n\nconst SurveyProgressBar = ({ rtl, ...props }: Props) => {\n  const feedbackState = useFeedbackState();\n  const themeColor = props.survey.surveyProperty.hexCode;\n  const insets = useSafeAreaInsets();\n  const { keyboardShown } = useKeyboard();\n\n  const insetsBottom =\n    // if it is android, and the insets bottom is not normal,\n    // maybe it is because the keyboard is showed, don't use this insets\n    isAndroid && insets.bottom >= 100 ? 0 : insets.bottom;\n\n  const containerStyle = React.useMemo(\n    () => [\n      styles.container,\n      {\n        backgroundColor: opacity10(themeColor),\n        paddingBottom: insetsBottom || 15,\n      },\n    ],\n    [insetsBottom, themeColor]\n  );\n\n  // hide this bar when it is android and keyboard is shown\n  if (isAndroid && keyboardShown) return null;\n\n  return (\n    <View style={containerStyle}>\n      <ProgressBar\n        value={numValidFeedbacks(feedbackState)}\n        maxValue={numTotalQuestions(props.survey)}\n        themeColor={themeColor}\n        rtl={rtl}\n      />\n    </View>\n  );\n};\n\nconst styles = StyleSheet.create({\n  container: {\n    paddingHorizontal: 30,\n    width: '100%',\n  },\n});\n\nexport default React.memo(SurveyProgressBar);\n"]}